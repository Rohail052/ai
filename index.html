<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Smart Chat Assistant</title>
  <style>
    /* Chat Button */
    #chat-launcher {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: #4f46e5;
      color: #fff;
      border: none;
      border-radius: 999px;
      padding: 14px 18px;
      font-size: 16px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      z-index: 9999;
      transition: background-color 0.3s ease;
    }

    #chat-launcher:hover {
      background-color: #4338ca;
    }

    /* Chat Popup Box */
    #chat-box {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 320px;
      max-width: 90%;
      background: #fff;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
      display: none;
      flex-direction: column;
      overflow: hidden;
      z-index: 9999;
    }

    #chat-header {
      background: #4f46e5;
      color: white;
      padding: 12px;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    #chat-close {
      background: transparent;
      color: white;
      border: none;
      font-size: 18px;
      cursor: pointer;
    }

    #chat-messages {
      padding: 12px;
      height: 180px;
      overflow-y: auto;
      font-size: 14px;
      color: #111827;
    }

    #chat-input-area {
      display: flex;
      border-top: 1px solid #e5e7eb;
    }

    #chat-input {
      flex: 1;
      padding: 10px;
      border: none;
      font-size: 14px;
      outline: none;
    }

    #chat-send {
      background: #4f46e5;
      color: white;
      border: none;
      padding: 10px 14px;
      cursor: pointer;
    }
  </style>
</head>
<body>

<!-- 🔘 Floating Chat Button -->
<button id="chat-launcher">💬 Chat</button>

<!-- 💬 Chat Assistant Box -->
<div id="chat-box">
  <div id="chat-header">
    Assistant
    <button id="chat-close">&times;</button>
  </div>
  <div id="chat-messages">
    👋 Hi! How can I help you today?
  </div>
  <div id="chat-input-area">
    <input type="text" id="chat-input" placeholder="Type your message..."/>
    <button id="chat-send">➤</button>
  </div>
</div>

<!-- ✅ Tidio Live Chat -->
<script src="//code.tidio.co/dknzsqzazptllq3meaiajmwkjiteftvi.js" async></script>

<!-- 💡 Smart Chat Logic -->
<script>
  const chatLauncher = document.getElementById('chat-launcher');
  const chatBox = document.getElementById('chat-box');
  const chatClose = document.getElementById('chat-close');
  const chatMessages = document.getElementById('chat-messages');
  const chatInput = document.getElementById('chat-input');
  const chatSend = document.getElementById('chat-send');

  const brain = {
    "i have a question": "Sure! What would you like to ask?",
    "help with login": "🔐 Login Help: Try 'Forgot Password' or clear browser cache.",
    "help with login/signup": "To sign up, click 'Register'. If you're stuck, refresh and try again.",
    "file help": "📁 For file issues, check your uploads folder and refresh the page.",
    "talk to an agent": "Connecting you to an agent via Tidio chat..."
  };

  chatLauncher.onclick = () => {
    chatBox.style.display = chatBox.style.display === 'flex' ? 'none' : 'flex';
  };

  chatClose.onclick = () => {
    chatBox.style.display = 'none';
  };

  chatSend.onclick = handleChat;
  chatInput.addEventListener('keydown', e => {
    if (e.key === 'Enter') handleChat();
  });

  function handleChat() {
    const userMsg = chatInput.value.trim().toLowerCase();
    if (!userMsg) return;

    addMessage("🧑‍💻 You: " + userMsg);
    chatInput.value = '';

    const reply = brain[userMsg] || "🤖 I'm not sure. Let me connect you to a live agent via the chat below.";
    addMessage("🤖 " + reply);

    if (userMsg.includes("agent") || reply.includes("connect")) {
      setTimeout(() => {
        TidioChatApi?.open();
      }, 1000);
    }
  }

  function addMessage(msg) {
    chatMessages.innerHTML += `<div>${msg}</div>`;
    chatMessages.scrollTop = chatMessages.scrollHeight;
  }
</script>

</body>
</html>
